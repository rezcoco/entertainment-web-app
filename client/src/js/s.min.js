window.addEventListener('load',(async()=>{const e=document.querySelector("#email"),t=document.querySelector("#password"),o=document.querySelector("#repeat-password"),s=document.querySelector(".error__container"),a=document.querySelectorAll("input"),n=document.querySelectorAll(".alert"),r=document.querySelectorAll(".bookmark"),c=document.querySelector(".signup"),l=document.querySelector(".login");function d(){return!e.value.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)&&"Please fill a valid Email address"}function i(){return!t.value.match(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,16}$/)&&"Enter a password combination of at least eight numbers, letters and punctuation marks (such as ! and &)."}function u(){a.forEach(((e,t)=>{e.addEventListener("blur",(()=>{""===e.value?(n[t].classList.remove("none"),e.classList.add("danger__border")):(n[t].classList.add("none"),e.classList.remove("danger__border"))}))}))}function m(){const e=[];return a.forEach(((t,o)=>{""===t.value&&(n[o].classList.remove("none"),t.classList.add("danger__border"),e.push(!1)),t.addEventListener("focus",(()=>{n[o].classList.add("none"),t.classList.remove("danger__border")}))})),e.every((e=>!0===e))}function p(e){const t=document.createElement("div");t.classList.add("error__msg");const o=document.createElement("p");o.setAttribute("class","fs-m error__txt"),o.textContent=e,t.append(o),s.append(t),setTimeout((()=>{t.style.opacity=1}),10),setTimeout((()=>{t.style.opacity=0,t.style.transform="translateY(-100%)",setTimeout((()=>{t.remove()}),300)}),4e3)}r.forEach((e=>{const t=e.querySelector("img"),o=e.getAttribute("id");e.addEventListener("click",(async()=>{console.log("bookmark");return(await fetch("/bookmark",{method:"POST",headers:"application/json",body:JSON.stringify({movieId:o})})).ok?(e.classList.toggle("empty"),e.classList.contains("empty")?void(t.src="./assets/icon-bookmark-empty.svg"):void(t.src="./assets/icon-bookmark-full.svg")):console.log("Add bookmark faliled")}))})),l&&(document.querySelector(".form").addEventListener("submit",(async function(o){try{if(o.preventDefault(),!m())return;const s=JSON.stringify({email:e.value,password:t.value}),a=new Headers({"Content-Type":"application/json"}),n=await fetch("/login",{method:"POST",body:s,headers:a}),r=await n.json();n.ok?(console.log(r.userId),localStorage.setItem("userId",r.userId),window.location.href="/"):p(r.message)}catch(e){console.log(e)}})),u()),c&&(document.querySelector(".form").addEventListener("submit",(async function(s){try{s.preventDefault();const a=[];if(t.value!==o.value&&a.push("Passwords doesn't match"),d()&&a.push(d()),i()&&a.push(i()),m(),a.length>0)return void a.forEach((e=>{p(e)}));const n=JSON.stringify({email:e.value,password:t.value,repeat_password:o.value}),r=new Headers({"Content-Type":"application/json"}),c=await fetch("/signup",{method:"POST",body:n,headers:r}),l=await c.json();c.ok?(console.log(l.userId),localStorage.setItem("userId",l.userId),window.location.href="/login"):p(l.message)}catch(e){console.log(e)}})),u())}));